## MySQL的正确书写：
###    不是Mysql ！
###    也不是MYSQL ！
###    而是MySQL ！


## 命名规范

- 表名、字段名、索引名使用小写字母、数字，采用下划线分割
- 表名、字段名不超过 32 个字符
- 存储实体数据的表，名称使用名词，单数
- 索引名称采用 `idx_` 前缀，之后顺序跟随索引的字段名，字段名直接以下划线分割
- 不使用保留字 [MySQL保留字查询](http://dev.mysql.com/doc/refman/5.6/en/keywords.html)
- 数据库库名、表名、字段名见名知意，不要拼音和英文混搭
- 临时表必须使用 `tmp_` 作为前缀
- chaoge 库的建表命名因为历史原因，新表name一律加 `inno_` 前缀


## 表的使用和设计

### MySQL 存储引擎使用 InnoDB

> 不用纠结，没有特殊原因的情况下，作为 OLTP 的 MySQL 使用 InnoDB 引擎。


### 正确使用时间类型  

> - 精确到秒时间类型采用 `TIMESTAMP`  （4字节） '1970-01-01 00:00:01'  to '2038-01-19 03:14:07' 支持时间点自动更新
> - 精确到秒时间类型也可以采用 `DATETIME` 类型  （8字节）'1000-01-01 00:00:00' to '9999-12-31 23:59:59' 支持时间点自动更新
> - 建议使用`TIMESTAMP`，可以满足一般的业务场景，并且占用的空间少
> - 精确到日期使用 `DATE` 或者 `int`,建议使用 `int`类型
> - **不允许使用字符串类型存储时间**
> - [相关文档链接：MySQL date and time types ](http://dev.mysql.com/doc/refman/5.6/en/date-and-time-types.html)


### 字段定义为 NOT NULL

> -  真的需要 `NULL` 值吗？如果不确定，就将字段设置为 `NOT NULL`。存在NULL的列，会让索引和索引统计都变得比较复杂，而且索引记录会添加一个额外的字节。
> -  含有`NULL`值的字段，统计的时候也会出问题,因为对null值的判断只有 is null 或者 is not null.
> -  设置为 `NOT NULL` 的字段，需要设置一个缺省值。通常我们建议在普通字段都加上 NOT NULL default值的设计。

### 不使用浮点类型（FLOAT、DOUBLE）

> 没有充分的理由，不要使用浮点数，可以采用 `DECIMAL`替代。

> 金额尽量不要用小数表示，可以以分为单位，然后采用 `INT`类型。


### 变长字段放后面

> 将定长的字段类型放到前面，比如 `int`、`timestamp`，变长的数据类型排在后面，比如 `varchar(N)`


### 字段个数不超过 32 个

> 一个表有很多很多字段，是坏设计的味道。请再认真考虑设计是否正确。


### 不直接存储图片、音频、视频等大容量内容

> 请使用分布式文件系统来存储图片、音频、视频等内容。数据库里只存储文件的位置。


### 使用 INT UNSIGNED 来存储 IPv4 地址

> 使用 `INET_ATON` 将 IP 地址的字符串形式转换成数字形式；使用 `INET_NTOA` 将 IP 地址数字形式转换成字符串形式，以便查看。
>
> 当要查询某段的 IP 时，请参考以下示例：
> ```sql
> SELECT user_id FROM user_ip
> WHERE ip > INET_ATON('192.168.0.0') AND ip < INET_ATON('192.168.255.255')
> ```
> 当程序使用自带的函数进行 IP 地址的字符串形式与数字形式之间的转换时，需要注意数字的存储类型至少应为 32 位的无符号整型（如 `uint32_t`)，并注意字节顺。

### 使用 TINYINT UNSIGNED 数据类型存储状态类字段  

> 节省存储空间，提高计算效率

如果不确定应该用int、smallint 还是 tinyint，可以看下[MySQL整型范围及存储消耗](http://dev.mysql.com/doc/refman/5.6/en/integer-types.html)

### 尽量减少对BLOB/TEXT的使用，用varchar(N)替代


### 总而言之，表结构的设计原则就是尽量减少行数据的存储空间，最大化内存和IO的使用效率。
[MySQL数据类型和空间使用查询链接](http://dev.mysql.com/doc/refman/5.6/en/storage-requirements.html)


## 索引使用

### 主键设计

> -  存储实体数据的表，请显式指定主键。
> -  存储实体数据的表，其主键应该是数字类型。
> -  存储实体数据的表，尽量不使用联合主键。
> -  建议使用和业务数据无关的自增id作为主键，存储的效率比较高。

### 索引设计

> - 合理创建联合索引， idx_A1（a,b,c) 同时也相当于 idx_A2(a) ，idx_A3（a,b) 
> - 对于like查询，一定要使用前缀匹配，形如like "%xxxxxx%"的查询是不会使用到索引的
> - 联合索引字段数不超过 5 个
> - 表中字段索引数也不要太多，增加表的维护成本
> - 不在低基数列上建立索引，例如“性别”
> - 在较长的字符类型的字段上建立前缀索引
> -  使用表连接查询时，JOIN列的数据类型必须相同，且需要建立索引

## SQL使用规范

> - sql语句尽可能简单，大语句拆小语句，减少锁时间，减少提交时间
> - update/insert/select 操作尽量根据主键进行条件筛选，提高执行效率
> - 不用select * ，这种写法消耗cpu，io，内存，带宽
> - 禁止隐式转换:数值类型禁止加引号；字符串类型必须加引号
> - 避免使用JOIN和子查询。必要时推荐用JOIN代替子查询
> - 合并结果集的操作，使用union all， 不要用union（union 会对产生的临时结果基做去唯一性检查，代价比较高）
> - 避免在MySQL中进行数学运算和函数运算，尤其是在where条件的筛选字段上作计算的话，会用不到索引，增加数据库查询负担
> - 对于任何select语句，在前面简单的加上explain就可以分析索引的使用情况了！请放心，EXPLAIN语法并不会实际执行sql（因此可能是慢查询的sql，也可以拿来试着玩），只是执行了MySQL的查询优化器，请活用EXPLAIN语句来优化查询！
